# –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–æ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ —Å–∏—Å—Ç–µ–º–µ.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í—Å–µ –º–µ—Ç–æ–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

- ‚úÖ –ü–∞—Ä–æ–ª–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Audit logging –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints

## üìã –°–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 1. Seed —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í —Ñ–∞–π–ª–µ .env
ADMIN_EMAIL="rrustamov986@gmail.com"
ADMIN_PASSWORD="Rrustamov9864"
ADMIN_NAME="Rustam Rustamov"
```

#### –ó–∞–ø—É—Å–∫

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
npm run db:seed

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
ADMIN_EMAIL="your@email.com" ADMIN_PASSWORD="yourpassword" npm run db:seed
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `seed_executions` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- ‚úÖ –í—ã–≤–æ–¥–∏—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª—å
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è

### 2. CLI —É—Ç–∏–ª–∏—Ç–∞ (–¥–ª—è DevOps)

–£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ CI/CD.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install yargs
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
npm run create-admin -- --interactive

# –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
npm run create-admin -- --email="your@email.com" --password="yourpassword" --name="Your Name"

# –ü–æ–º–æ—â—å
npm run create-admin -- --help
```

#### –ü—Ä–∏–º–µ—Ä—ã

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
npm run create-admin -- --email="admin@example.com" --password="SecurePass123"

# –° –ø–æ–ª–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
npm run create-admin -- --email="admin@example.com" --password="SecurePass123" --name="John Doe"

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
npm run create-admin -- --interactive
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email –∏ –ø–∞—Ä–æ–ª—è
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Graceful shutdown

### 3. API endpoint (–¥–ª—è production)

–°–∞–º—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è.

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –í —Ñ–∞–π–ª–µ .env
INIT_ADMIN_TOKEN="your-super-secret-init-token-here"
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
curl -X POST http://localhost:3000/api/v1/auth/internal/init-admin \
  -H "Content-Type: application/json" \
  -H "x-init-token: your-super-secret-init-token-here" \
  -d '{
    "email": "admin@example.com",
    "password": "SecurePass123"
  }'
```

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "message": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä admin@example.com —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
}
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ó–∞—â–∏—â–µ–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
- ‚úÖ –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (—Ç–æ–∫–µ–Ω –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è)
- ‚úÖ Rate limiting
- ‚úÖ Audit logging —Å IP –∞–¥—Ä–µ—Å–æ–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ DTO

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
backend/
‚îú‚îÄ‚îÄ src/auth/
‚îÇ   ‚îú‚îÄ‚îÄ dto/init-admin.dto.ts      # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ guards/init-admin.guard.ts # –ó–∞—â–∏—Ç–∞ endpoint
‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts            # –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ auth.controller.ts         # API endpoint
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ seed.ts                    # Seed —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ create-admin.js            # CLI —É—Ç–∏–ª–∏—Ç–∞
‚îî‚îÄ‚îÄ env.example                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü–∞ seed_executions

```sql
CREATE TABLE seed_executions (
  id SERIAL PRIMARY KEY,
  seed_name VARCHAR(255) NOT NULL,
  executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  status VARCHAR(50) DEFAULT 'success'
);
```

#### Audit logging

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `audit_logs`:

```sql
INSERT INTO audit_logs (user_id, action, resource, resource_id, details)
VALUES (
  'admin-id',
  'INIT_ADMIN',
  'USER',
  'admin-id',
  '{"method": "init-admin", "ipAddress": "127.0.0.1", "email": "admin@example.com"}'
);
```

## üöÄ Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
INIT_ADMIN_TOKEN="your-super-secret-init-token-here"
JWT_SECRET="your-jwt-secret"
JWT_REFRESH_SECRET="your-refresh-secret"

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–¥–ª—è seed)
ADMIN_EMAIL="admin@yourdomain.com"
ADMIN_PASSWORD="your-secure-password"
ADMIN_NAME="Admin Name"
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```bash
# –°–ø–æ—Å–æ–± 1: API endpoint (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
curl -X POST https://yourdomain.com/api/v1/auth/internal/init-admin \
  -H "Content-Type: application/json" \
  -H "x-init-token: your-super-secret-init-token-here" \
  -d '{"email": "admin@yourdomain.com", "password": "SecurePass123"}'

# –°–ø–æ—Å–æ–± 2: CLI —É—Ç–∏–ª–∏—Ç–∞
npm run create-admin -- --email="admin@yourdomain.com" --password="SecurePass123"

# –°–ø–æ—Å–æ–± 3: Seed —Å–∫—Ä–∏–ø—Ç
ADMIN_EMAIL="admin@yourdomain.com" ADMIN_PASSWORD="SecurePass123" npm run db:seed
```

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ò–∑–º–µ–Ω–∏—Ç–µ INIT_ADMIN_TOKEN –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ production
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ API
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ audit logs
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Audit logs

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```json
{
  "action": "INIT_ADMIN",
  "resource": "USER",
  "details": {
    "method": "init-admin",
    "ipAddress": "192.168.1.100",
    "email": "admin@example.com",
    "role": "ADMIN"
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API
curl -X GET http://localhost:3000/api/v1/auth/me \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
SELECT id, email, role, created_at FROM users WHERE role = 'ADMIN';
```

## ‚ùó –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–∞—Ä–æ–ª–∏**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –∫–æ–¥–µ –∏–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. **–¢–æ–∫–µ–Ω—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–µ —Ç–æ–∫–µ–Ω—ã
3. **–õ–æ–≥–∏**: –ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª–∏ –∏–ª–∏ —Ç–æ–∫–µ–Ω—ã
4. **–î–æ—Å—Ç—É–ø**: –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ endpoint —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "User already exists"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT email, role FROM users WHERE email = 'your@email.com';

# –£–¥–∞–ª–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
DELETE FROM users WHERE email = 'your@email.com';
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid init token"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo $INIT_ADMIN_TOKEN

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run start:dev
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Database connection failed"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
npm run prisma:studio

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DATABASE_URL
echo $DATABASE_URL
```
